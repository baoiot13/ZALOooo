<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2 Nhi</title>

<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    background:#e5e7eb;
    height:100vh;
    display:flex;
    flex-direction:column;
    overflow:hidden;
}

/* HEADER */
.header{
    background:#0068ff;
    color:white;
    padding:12px 15px;
    display:flex;
    align-items:center;
}

.avatar{
    width:36px;
    height:36px;
    border-radius:50%;
    background:url("https://i.pravatar.cc/100?img=5");
    background-size:cover;
    margin-right:10px;
}

.name{
    font-weight:600;
    font-size:16px;
}

.status{
    font-size:12px;
    opacity:.85;
}

/* CHAT */
.chat-box{
    flex:1;
    overflow-y:auto;
    padding:15px;
    display:flex;
    flex-direction:column;
    -webkit-overflow-scrolling:touch;
}

.message{
    max-width:75%;
    padding:10px 14px;
    border-radius:18px;
    margin:4px 0;
    font-size:15px;
    line-height:1.4;
    word-wrap:break-word;
}

.bot{
    background:white;
    align-self:flex-start;
}

.user{
    background:#0084ff;
    color:white;
    align-self:flex-end;
}

.recalled{
    font-style:italic;
    color:gray;
    background:none;
}

/* INPUT */
.input-area{
    display:flex;
    padding:10px;
    background:white;
    border-top:1px solid #ddd;
}

input{
    flex:1;
    padding:10px;
    border-radius:20px;
    border:1px solid #ccc;
    font-size:15px;
}

button{
    margin-left:8px;
    padding:10px 15px;
    border:none;
    border-radius:20px;
    background:#0068ff;
    color:white;
}

/* typing */
.typing{
    display:flex;
    margin:5px 0;
}

.dot{
    width:6px;
    height:6px;
    background:gray;
    border-radius:50%;
    margin:0 2px;
    animation:blink 1.4s infinite both;
}

.dot:nth-child(2){animation-delay:.2s;}
.dot:nth-child(3){animation-delay:.4s;}

@keyframes blink{
    0%{opacity:.2;}
    20%{opacity:1;}
    100%{opacity:.2;}
}
</style>
</head>

<body>

<div class="header">
    <div class="avatar"></div>
    <div>
        <div class="name">2 Nhi</div>
        <div class="status">Đang hoạt động</div>
    </div>
</div>

<div class="chat-box" id="chatBox">

<div class="message bot">
    e qua đây chị nhờ tí, nhanh lên
</div>

<div class="message bot">
    đi cẩn thận, m mà mở cái giấy ra hay mở đồ t ra là t đá m đó
</div>

<div class="message bot">
    sáng nhà cúng chx.
</div>

<div class="message bot">
    À mà trưa nay nhớ làm cái chị nói đó nha, đừng có quên đó, tí qua chị đưa tiền.
</div>

</div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Nhập tin nhắn..." onkeypress="if(event.key==='Enter') sendMessage()">
    <button onclick="sendMessage()">Gửi</button>
</div>

<script>

let step=0;
let recallMessages=[];

/* ===== NỘI DUNG TỪ FILE CŨ ===== */
let DOAN1="shop ơi, shop có bán áo lót nữ ko, trả lời có hoặc ko giúp e nhé, e về gấp quá quên mang đồ tùm lum hết, mà giờ xe hư nên nhừ thx e của e đi, đừng nói nó biết nha, ko lại mất công lắm, hôm qua e nhờ nó mua mấy cái quần, e cảm ơn shop!";
let A="chị lấy e 5 cái nha";
let B="tiết vậy, thôi e cảm ơn shop nha";
let C="loại nào mềm mềm là dc ạ, loại su vs nếu có áo lá lấy e thêm 5 cái nha chị, có độn càn tốt ạ, size thì lấy vừa là dc ạ, lấy gấp giúp e cho nó về ạ";
let D="dạ v lấy e 5 cái, loại nào mềm mềm á chị, à mà có áo lá hoặc áo su lấy e thêm 5 cái cho nhỏ em luôn, size thì lấy vừa vừa là dc ạ, lấy gấp giúp e cho nó về ạ";
/* ================================= */

function addMessage(text,type,track=false){
    let msg=document.createElement("div");
    msg.classList.add("message",type);
    msg.innerText=text;
    chatBox.appendChild(msg);
    chatBox.scrollTop=chatBox.scrollHeight;

    if(track){
        recallMessages.push(msg);
    }
}

function showTyping(callback){
    let typing=document.createElement("div");
    typing.classList.add("typing");
    typing.innerHTML='<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
    chatBox.appendChild(typing);
    chatBox.scrollTop=chatBox.scrollHeight;

    setTimeout(()=>{
        typing.remove();
        callback();
    },2000);
}

function recallBotMessages(){
    recallMessages.forEach(msg=>{
        msg.innerText="Tin nhắn đã bị thu hồi";
        msg.classList.remove("bot");
        msg.classList.add("recalled");
    });
}

function sendMessage(){

    let input=document.getElementById("userInput");
    let text=input.value.trim();
    if(text==="") return;

    addMessage(text,"user");
    input.value="";
    let lower=text.toLowerCase();

    showTyping(()=>{

        if(step===0){
            if(lower.includes("ok")){
                step=1;
            }
        }

        else if(step===1){
            if(lower.includes("tới r")){
                addMessage(DOAN1,"bot",true);
                step=2;
            }
        }

        else if(step===2){
            if(lower.includes("có")){
                addMessage(A,"bot",true);
                step=3;
            }
            else if(lower.includes("không")||lower.includes("ko")){
                addMessage(B,"bot",true);
                step=3;
            }
        }

        else if(step===3){

            if(lower.includes("loại nào")||lower.includes("kích cỡ")){
                addMessage(C,"bot",true);
            }else{
                addMessage(D,"bot",true);
            }

            setTimeout(()=>{
                recallBotMessages();

                setTimeout(()=>{
                    addMessage("Cảm ơn!, đừng nói vs nó nha shop","bot");
                },5000);

            },2000);

            step=4;
        }

    });
}

</script>

</body>
</html>
